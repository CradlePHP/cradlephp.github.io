<!DOCTYPE html>
<html lang="en" class="branding ">
    <head>
        <meta charset="utf-8" />
        <title>Middleware - CradlePHP</title>

        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        
        <meta name="description" content="Middleware Introduction Pre-Processing Error Processing Post Processing API (9) Introduction Middleware is a concept of allowing p" />
        
        <meta name="keywords" content="php,framework,cradle,middleware" />
        

        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

        <link rel="icon" type="image/png" href="/favicon.png" />
		<link rel="icon" type="image/gif" href="/favicon.gif" />
        <link rel="icon" href="/favicon.ico" type="image/x-icon">

        <!-- FACEBOOK TAGS -->
        <meta property="og:image" content="https://cradlephp.github.io/www/images/logo-long.png" />

        <meta property="og:title" content="Middleware - CradlePHP" />

        <meta property="og:description" content="Middleware Introduction Pre-Processing Error Processing Post Processing API (9) Introduction Middleware is a concept of allowing p" />

        <meta property="og:type" content="website" />

        <meta property="og:url" content="https://cradlephp.github.io/" />

        <!-- TWITTER TAGS -->
        <meta name="twitter:card" content="summary" />

        <meta name="twitter:image" content="https://cradlephp.github.io/www/images/logo-long.png" />

        <meta name="twitter:title" content="Middleware - CradlePHP" />

        <meta name="twitter:description" content="Middleware Introduction Pre-Processing Error Processing Post Processing API (9) Introduction Middleware is a concept of allowing p" />

        <meta name="twitter:url" content="https://cradlephp.github.io/" />

        <!-- SCHEMA.ORG TAGS -->
        <meta itemprop="name" content="Cradle PHP" />
        <meta itemprop="openingHours" content="Mo,Tu,We,Th,Fr 10:00-20:00" />

        <link itemprop="url" content="https://cradlephp.github.io/" />
        <link itemprop="logo" content="https://cradlephp.github.io/www/images/logo-long.png" />
        <link itemprop="image" content="https://cradlephp.github.io/www/images/logo-long.png" />

        <link rel="stylesheet" type="text/css" href="/bower_components/font-awesome/css/font-awesome.min.css" />
        <link rel="stylesheet" type="text/css" href="/bower_components/opensans-webfont-latin/css/opensans-latin.css" />
        <link rel="stylesheet" type="text/css" href="/bower_components/bootstrap/dist/css/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="/www/styles/prism.css" />
        <link rel="stylesheet" type="text/css" href="/www/styles/custom.css" />

        <script type="text/javascript" src="/bower_components/jquery/dist/jquery.min.js"></script>
        <script type="text/javascript" src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    </head>

    <body>
    	<header>
            <nav class="navbar navbar-default navbar-branding navbar-static-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><img alt="Cradle PHP" src="/www/images/logo-long.png" /></a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="header">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="/">Home</a></li>
                <li><a href="/docs/install.html">Getting Started</a></li>
                <li><a href="https://github.com/CradlePHP/Cradle"><i class="fa fa-github"></i></a></li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>

        </header>

        <section class="body">
            <div class="container">
                
                 <div class="documentation">
    <div class="row">
        <div class="left col-xs-12 col-md-2">
            <h5>Getting Started</h5>
<ul>
    <li><a href="/docs/install.html">Install</a></li>
    <li><a href="/docs/introduction.html">Introduction</a></li>
    <li><a href="/docs/sink.html">Kitchen Sink</a></li>
</ul>

<h5>Concepts</h5>
<ul>
    <li><a href="/docs/events.html">Events</a></li>
    <li><a href="/docs/flows.html">Flows</a></li>
    <li><a href="/docs/routing.html">Routing</a></li>
    <li><a href="/docs/middleware.html">Middleware</a></li>
    <li><a href="/docs/request.html">Request</a></li>
    <li><a href="/docs/response.html">Response</a></li>
    <li><a href="/docs/integration.html">Integration</a></li>
    <li><a href="/docs/packages.html">Packages</a></li>
</ul>

<h5>Core Traits</h5>
<ul>
    <li><a href="/docs/helper.html">Helper</a></li>
    <li><a href="/docs/data.html">Data</a></li>
    <li><a href="/docs/resolver.html">Resolver</a></li>
    <li><a href="/docs/profiler.html">Profiler</a></li>
</ul>

<!--<h5>Core Packages</h5>
<ul>
    <li><a href="/docs/curl.html">cURL</a></li>
    <li><a href="/docs/handlebars.html">Handlebars</a></li>
    <li><a href="/docs/image.html">Image</a></li>
    <li><a href="/docs/sql.html">SQL</a></li>
</ul>-->

<h5>Kitchen Sink</h5>
<ul>
    <li><a href="/docs/sink-overview.html">Overview</a></li>
    <li><a href="/docs/sink-bootstrap.html">Bootstrap</a></li>
    <li><a href="/docs/sink-models.html">Models</a></li>
    <li><a href="/docs/sink-jobs.html">Jobs</a></li>
    <li><a href="/docs/sink-controllers.html">Controllers</a></li>
    <li><a href="/docs/sink-templates.html">Templates</a></li>
</ul>
<!--
    <li><a href="/docs/sink-cli.html">Custom CLI Commands</a></li>

    <li><a href="/docs/sink-auth.html">Authentication</a></li>
    <li><a href="/docs/sink-files.html">File Uploading</a></li>
    <li><a href="/docs/sink-mail.html">Sending Mail</a></li>
    <li><a href="/docs/sink-queue.html">Queuing Jobs</a></li>
    <li><a href="/docs/sink-optimization.html">Optimization</a></li>
    <li><a href="/docs/sink-security.html">Security Cases</a></li>
    <li><a href="/docs/sink-i18n.html">i18n</a></li>
</ul>-->
   
        </div>
        <div class="right col-xs-12 col-md-10">
        	<h1>Middleware</h1>
<ul>
<li><i class="fa fa-arrow-right"></i><a href="#intro">Introduction</a></li>
<li><i class="fa fa-arrow-right"></i><a href="#pre">Pre-Processing</a></li>
<li><i class="fa fa-arrow-right"></i><a href="#error">Error Processing</a></li>
<li><i class="fa fa-arrow-right"></i><a href="#post">Post Processing</a></li>
<li><i class="fa fa-arrow-right"></i><a href="#api">API (9)</a></li>
</ul>
<p><a name="intro"></a></p>
<h2><i class="fa fa-arrow-down"></i> Introduction</h2>
<p>Middleware is a concept of allowing pieces of functionality to be injected
anywhere at your discretion. Almost like plugins or extensions, the popularity
of middleware came from third party vendors being able to quickly plug into
applications.</p>
<p>Routes is a kind of middleware interface because you can add functionality
using the include method explained before.</p>
<h6>Routing Middleware Interface</h6>
<pre class="code line-numbers language-php"><code class="marked">&lt;?php
cradle()-&gt;get('/some/path', include('/some/event/handler'));

</code></pre>
<p>There are other areas where you may need to plug in to other than the time of
routing for example before and after the routing and during an error.</p>
<p><a name="pre"></a></p>
<h2><i class="fa fa-arrow-down"></i> Pre-Processing</h2>
<p>Middleware can be inserted before routing with the following example.</p>
<pre class="code line-numbers language-php"><code class="marked">&lt;?php
cradle()-&gt;preprocess(function($request, $response) {
    //Do something before routing
});

</code></pre>
<p>Like routing, a <code class="language-php">$request</code> and a <code class="language-php">$response</code> will be passed. The usual
activity for a <code class="language-php">-&gt;preprocess()</code> would be populating the <code class="language-php">$request</code> further,
presetting a $response and/or adding more available methods. The Bootstrap
heavily uses <code class="language-php">-&gt;preprocess()</code> for example.</p>
<p><a name="error"></a></p>
<h2><i class="fa fa-arrow-down"></i> Error Processing</h2>
<pre class="code line-numbers language-php"><code class="marked">&lt;?php
cradle()-&gt;error(function($request, $response, $error) {
    //Do something because there was an error
});

</code></pre>
<p>With error processors, like pre-processors a $request and a $response will be
passed. A third argument called <code class="language-php">$error</code> will also be passed which will be an
<strong>Exception</strong> object. Error processors should be treated as a last ditch effort
to report the error to the user in a nice way.</p>
<div class="alert alert-danger"><i class="fa fa-times"></i> Because errors that happen in an error handler will throw that error if not caught again.
Bootstrap: Errors presets what happens whens there's an error and your free to change/remove/add on to it.
</div>
<p><a name="post"></a></p>
<h2><i class="fa fa-arrow-down"></i> Post Processing</h2>
<pre class="code line-numbers language-php"><code class="marked">&lt;?php
cradle()-&gt;postprocess(function($request, $response, $error) {
    //Do something after the connection is closed
});

</code></pre>
<p>Post processors are like pre-processors except that it waits till the user
has received a response and the connection is closed before being activated.
This is a nice feature where you can do short time consuming tasks if you do
not have access to a queue available.</p>
<div class="alert alert-warning"><i class="fa fa-exclamation-triangle"></i>  A caveat about post-processors is that writing to sessions will no longer be
 available. You can write to it, but on refresh, it won't remember it like if
 it was still open.
</div>
<p><a name="api"></a></p>
<h2><i class="fa fa-arrow-down"></i> API</h2>
<p><code class="language-php">preprocess</code> - Adds pre processing middleware which is called before routing</p>
<pre class="code line-numbers language-php"><code class="marked">
cradle()-&gt;preprocess(function($request, $response) {
    //Do something before routing
});

</code></pre>
<hr />
<p><code class="language-php">error</code> - Adds error middleware which is called when an Exception is thrown</p>
<pre class="code line-numbers language-php"><code class="marked">
cradle()-&gt;error(function($request, $response) {
    //Do something because there was an error
});

</code></pre>
<hr />
<p><code class="language-php">postprocess</code> - Adds post processing after the response was sent out and the connection is closed</p>
<pre class="code line-numbers language-php"><code class="marked">
cradle()-&gt;postprocess(function($request, $response) {
    //Do something after the connection is closed
});

</code></pre>
<hr />
<p><code class="language-php">setPreprocessor</code> - Allows for a custom pre processor to be used</p>
<table class="table table-striped table-bordered">
<thead>
<tr>
<th>Parameters</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code class="language-php">Cradle\Http\Middleware\MiddlewareInterface</code></td>
<td>The middleware interface (<code class="language-php">new Cradle\Http\Middleware</code>)</td>
</tr>
</tbody>
</table>
<pre class="code line-numbers language-php"><code class="marked">
cradle()-&gt;setPreProcessor(new Cradle\Http\Middleware);

</code></pre>
<hr />
<p><code class="language-php">getPreProcessor</code> - Returns a Middleware processor if none was set, it will auto create one</p>
<pre class="code line-numbers language-php"><code class="marked">
cradle()-&gt;getPreprocessor();

</code></pre>
<hr />
<p><code class="language-php">setErrorProcessor</code> - Allows for a custom error processor to be used</p>
<table class="table table-striped table-bordered">
<thead>
<tr>
<th>Parameters</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code class="language-php">Cradle\Http\Middleware\MiddlewareInterface</code></td>
<td>The middleware interface (<code class="language-php">new Cradle\Http\Middleware</code>)</td>
</tr>
</tbody>
</table>
<pre class="code line-numbers language-php"><code class="marked">
cradle()-&gt;setErrorProcessor(new Cradle\Http\Middleware);

</code></pre>
<hr />
<p><code class="language-php">getErrorProcessor</code> - Returns a Middleware processor if none was set, it will auto create one</p>
<pre class="code line-numbers language-php"><code class="marked">
cradle()-&gt;getErrorProcessor();

</code></pre>
<hr />
<p><code class="language-php">setPostProcessor</code> - Allows for a custom post processor to be used</p>
<table class="table table-striped table-bordered">
<thead>
<tr>
<th>Parameters</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code class="language-php">Cradle\Http\Middleware\MiddlewareInterface</code></td>
<td>The middleware interface (<code class="language-php">new Cradle\Http\Middleware</code>)</td>
</tr>
</tbody>
</table>
<pre class="code line-numbers language-php"><code class="marked">
cradle()-&gt;setPostProcessor(new Cradle\Http\Middleware);

</code></pre>
<hr />
<p><code class="language-php">getPostProcessor</code> - Returns a Middleware processor if none was set, it will auto create one</p>
<pre class="code line-numbers language-php"><code class="marked">
cradle()-&gt;getPostProcessor();

</code></pre>
        </div>

    </div>
</div>

            </div>
        </section>
        <footer>
            <div class="container">
	<div class="top clearfix">
        <div class="left pull-left">
            <div>
                <div class="logo pull-left"><img src="/www/images/logo-square.png" /></div>
                <div class="title">Cradle PHP</div>
                <ul>
                    <li><a href="https://github.com/CradlePHP/Cradle">GitHub</a></li>
                    <li><a href="https://packagist.org/packages/cradlephp/cradle">Packagist</a></li>
                </ul>
            </div>
        </div>

        <div class="middle pull-right">
            <ul>
                <li><a href="/docs/install.html">Getting Started</a></li>
                <li><a href="/docs/introduction.html">Introduction</a></li>
                <li><a href="/docs/introduction.html">Documentation</a></li>
            </ul>
        </div>


    </div>
    <div class="masthead">
    	<center class="copy">
            <a href="https://travis-ci.org/CradlePHP/framework"><img src="https://travis-ci.org/CradlePHP/framework.svg?branch=master" alt="Travis CI" style="max-width:100%;"></a>
            <a href='https://coveralls.io/github/CradlePHP/framework?branch=master'><img src='https://coveralls.io/repos/github/CradlePHP/framework/badge.svg?branch=master' alt='Coverage Status' /></a>
            <a href="https://packagist.org/packages/cradlephp/framework"><img src="https://poser.pugx.org/cradlephp/framework/v/stable" alt="Latest Stable Version"  style="max-width:100%;"></a>
            <a href="https://packagist.org/packages/cradlephp/framework"><img alt="Total Downloads" src="https://poser.pugx.org/cradlephp/framework/downloads" style="max-width:100%;"></a>
            <a href="https://packagist.org/packages/cradlephp/framework"><img alt="Latest Unstable Version" src="https://poser.pugx.org/cradlephp/framework/v/unstable" style="max-width:100%;"></a>
            <a href="https://packagist.org/packages/cradlephp/framework"><img alt="License" src="https://poser.pugx.org/cradlephp/framework/license" style="max-width:100%;"></a>
            <br /><br />&copy; CradlePHP 2016
        </center>
    </div>
</div>

        </footer>
        <script type="text/javascript" src="/www/scripts/prism.js"></script>
    </body>
</html>
