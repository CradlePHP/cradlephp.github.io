
<!DOCTYPE html>
<html lang="en" class="branding ">
    <head>
        <meta charset="utf-8" />
        <title>Cradle PHP</title>
        
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        
        
        
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
		<link rel="icon" href="/favicon.ico" type="image/x-icon">
        
        <link rel="stylesheet" type="text/css" href="/bower_components/eve-font-awesome/awesome.css" />
        <link rel="stylesheet" type="text/css" href="/bower_components/eve-open-sans/open-sans.css" />
        <link rel="stylesheet" type="text/css" href="/bower_components/eve-bootstrap/bootstrap.css" />
        <link rel="stylesheet" type="text/css" href="/bower_components/eve-open-sans/open-sans.css" />
        <link rel="stylesheet" type="text/css" href="/www/styles/prism.css" />
        <link rel="stylesheet" type="text/css" href="/www/styles/custom.css" />
        
        <script type="text/javascript" src="/bower_components/eve-jquery/jquery.js"></script>
        <script type="text/javascript" src="/bower_components/eve-bootstrap/bootstrap.js"></script>
    </head>

    <body>
    	<header>
        	<nav class="navbar navbar-default navbar-branding navbar-static-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><img alt="Cradle PHP" src="/www/images/logo-long.png" /></a>
        </div>
        
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="header">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="/">Home</a></li>
                <li><a href="/docs/install.html">Getting Started</a></li>
                <li><a href="/docs/intro.html">Documentation</a></li>
                <li><a href="https://github.com/CradlePHP/Cradle"><i class="fa fa-github"></i></a></li>
            
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>
        </header>
        <section class="body">
            <div class="container">
                
                <div class="documentation">
    <div class="row">
        <div class="left col-xs-12 col-md-2">
    <h5>Getting Started</h5>
    <ul>
        <li><a href="/docs/install.html">Install</a></li>
        <li><a href="/docs/intro.html">Introduction</a></li>
    </ul>

    <h5>Features</h5>
    <ul>
        <li><a href="/docs/bootstrap.html">Bootstrap</a></li>
        <li><a href="/docs/events.html">Events</a></li>
        <li><a href="/docs/flows.html">Flows</a></li>
        <li><a href="/docs/routing.html">Routing</a></li>
        <li><a href="/docs/middleware.html">Middleware</a></li>
        <li><a href="/docs/request.html">Request</a></li>
        <li><a href="/docs/response.html">Response</a></li>
        <li><a href="/docs/piping.html">Piping</a></li>
        <li><a href="/docs/integration.html">Integration</a></li>
        <li><a href="/docs/packages.html">Packages</a></li>
    </ul>
</div>
        <div class="right col-xs-12 col-md-10">
        	<h1>Middleware</h1>
            
            <ul>
            	<li><i class="fa fa-arrow-right"></i><a href="#intro">Introduction</a></li>
            	<li><i class="fa fa-arrow-right"></i><a href="#pre">Pre-Processing </a></li>
            	<li><i class="fa fa-arrow-right"></i><a href="#error">Error Processing</a></li>
            	<li><i class="fa fa-arrow-right"></i><a href="#post">Post Processing</a></li>
            </ul>
            
            <a name="intro"></a>
            <h2><i class="fa fa-arrow-down"></i> Introduction</h2>
            
            <p>Middleware is a concept of allowing pieces of functionality to be 
            injected anywhere at your discretion. Almost like plugins or extensions,
            the popularity of middleware came from third party vendors being able to
            quickly plug into applications.</p>
            
            <p><a href="/docs/routing.html">Routes</a> is a kind of middleware 
            interface because you can add functionality using the include method 
            explained before.</p>
            
            <h6>Routing Middleware Interface</h6>
            <pre class="code line-numbers language-php"><code>&lt;?php
cradle()->get('/some/path', include('/some/event/handler'));

</code></pre>

			<p>There are other areas where you may need to plug in to other than the 
            time of routing for example before and after the routing and during an error.</p>
            
            <a name="pre"></a>
            <h2>Pre-Processing</h2>
			<p>Middleware can be inserted before routing with the following example.</p>
            <pre class="code line-numbers language-php"><code>&lt;?php
cradle()->preprocess(function($request, $response) {
	//Do something before routing
});

</code></pre>
			
            <p>Like routing, a <code class="language-php">$request</code> and a 
            <code class="language-php">$response</code> will be passed. The usual
            activity for a <code class="language-php">->preprocess()</code> would
            be populating the <code class="language-php">$request</code> further,
            presetting a <code class="language-php">$response</code> and/or adding
            more avaialble methods. The <a href="/docs/bootstrap.html">Bootstrap</a>
            heavily uses <code class="language-php">->preprocess()</code> for example.</p>

            <a name="error"></a>
			<h2>Error Processing</h2>
            
			<pre class="code line-numbers language-php"><code>&lt;?php
cradle()->error(function($request, $response, $error) {
	//Do something because there was an error
});

</code></pre>

			<p>With error processors, like pre-processors a <code class="language-php">$request</code> and a 
            <code class="language-php">$response</code> will be passed. A third argument called 
            <code class="language-php">$error</code> will also be passed which will be an 
            <strong>Exception</strong> object. Error processors should be treated as a last ditch 
            effort to report the error to the user in a nice way.</p>
            
            <div class="alert alert-danger"><i class="fa fa-times-circle"></i>
            Because errors that happen in an error handler will throw that error if not caught again.
            </div>
            
            <p><a href="http://cradle.openovate.dev/docs/bootstrap.html#errors">Bootstrap: Errors</a> 
            presets what happens whens there's an error and your free to change/remove/add on to it.
            
            <a name="post"></a>
			<h2>Post Processing</h2>
            
			<pre class="code line-numbers language-php"><code>&lt;?php
cradle()->postprocess(function($request, $response, $error) {
	//Do something after the connection is closed
});

</code></pre>

			<p>Post processors are like pre-processors except that it waits till the user has received a 
            response and the connection is closed before being activated. This is a nice feature where you
            can do short time consuming tasks if you do not have access to a queue available.</p>
            
            
            <div class="alert alert-warning"><i class="fa fa-exclamation-triangle"></i>
            A caveat about post-processors is that writing to sessions will no longer be available. You can 
            write to it, but on refresh, it won't remember it like if it was still open.
            </div>
            
        </div>
    </div>
</div>
            </div>
        </section>
        <footer>
        	<div class="container">
	<div class="top clearfix">
        <div class="left pull-left">
            <div>
                <div class="logo pull-left"><img src="/www/images/logo-square.png" /></div>
                <div class="title">Cradle PHP</div>
                <ul>
                    <li><a href="https://github.com/CradlePHP/Cradle">GitHub</a></li>
                    <li><a href="https://packagist.org/packages/cradlephp/cradle">Packagist</a></li>
                </ul>
            </div>
        </div>
        
        <div class="middle pull-right">
            <ul>
                <li><a href="/docs/intro.html">Getting Started</a></li>
                <li><a href="/docs/install.html">Install</a></li>
                <li><a href="/">Documentation</a></li>
            </ul>
        </div>
    </div>
    <div class="masthead">
    	<center class="copy">&copy; Cradle PHP 2016</center>
    </div>
</div>
        </footer>
        <script type="text/javascript" src="/www/scripts/prism.js"></script>
    </body>
</html>
