<!DOCTYPE html>
<html lang="en" class="branding ">
    <head>
        <meta charset="utf-8" />
        <title>Facades - CradlePHP</title>

        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        
        <meta name="description" content="Facades To start off with a reference, we will be using the setup described in Writing an App. The first thing you want to do befo" />
        
        <meta name="keywords" content="php,framework,cradle,facades" />
        

        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

        <link rel="icon" type="image/png" href="/favicon.png" />
		<link rel="icon" type="image/gif" href="/favicon.gif" />
        <link rel="icon" href="/favicon.ico" type="image/x-icon">

        <!-- FACEBOOK TAGS -->
        <meta property="og:image" content="https://cradlephp.github.io/www/images/logo-long.png" />

        <meta property="og:title" content="Facades - CradlePHP" />

        <meta property="og:description" content="Facades To start off with a reference, we will be using the setup described in Writing an App. The first thing you want to do befo" />

        <meta property="og:type" content="website" />

        <meta property="og:url" content="https://cradlephp.github.io/" />

        <!-- TWITTER TAGS -->
        <meta name="twitter:card" content="summary" />

        <meta name="twitter:image" content="https://cradlephp.github.io/www/images/logo-long.png" />

        <meta name="twitter:title" content="Facades - CradlePHP" />

        <meta name="twitter:description" content="Facades To start off with a reference, we will be using the setup described in Writing an App. The first thing you want to do befo" />

        <meta name="twitter:url" content="https://cradlephp.github.io/" />

        <!-- SCHEMA.ORG TAGS -->
        <meta itemprop="name" content="Cradle PHP" />
        <meta itemprop="openingHours" content="Mo,Tu,We,Th,Fr 10:00-20:00" />

        <link itemprop="url" content="https://cradlephp.github.io/" />
        <link itemprop="logo" content="https://cradlephp.github.io/www/images/logo-long.png" />
        <link itemprop="image" content="https://cradlephp.github.io/www/images/logo-long.png" />

        <link rel="stylesheet" type="text/css" href="/bower_components/font-awesome/css/font-awesome.min.css" />
        <link rel="stylesheet" type="text/css" href="/bower_components/opensans-webfont-latin/css/opensans-latin.css" />
        <link rel="stylesheet" type="text/css" href="/bower_components/bootstrap/dist/css/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="/www/styles/prism.css" />
        <link rel="stylesheet" type="text/css" href="/www/styles/custom.css" />

        <script type="text/javascript" src="/bower_components/jquery/dist/jquery.min.js"></script>
        <script type="text/javascript" src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    </head>

    <body>
    	<header>
            <nav class="navbar navbar-default navbar-branding navbar-static-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><img alt="Cradle PHP" src="/www/images/logo-long.png" /></a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="header">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="/">Home</a></li>
                <li><a href="/docs/install.html">Getting Started</a></li>
                <li><a href="https://github.com/CradlePHP/Cradle"><i class="fa fa-github"></i></a></li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>

        </header>

        <section class="body">
            <div class="container">
                
                 <div class="documentation">
    <div class="row">
        <div class="left col-xs-12 col-md-2">
            <h5>Getting Started</h5>
<ul>
    <li><a href="/docs/install.html">Install</a></li>
    <li><a href="/docs/app.html">Writing an App</a></li>
    <li><a href="/docs/bootstrap.html">Bootstrap</a></li>
</ul>

<h5>Concepts</h5>
<ul>
    <li><a href="/docs/events.html">Events</a></li>
    <li><a href="/docs/flows.html">Flows</a></li>
    <li><a href="/docs/routing.html">Routing</a></li>
    <li><a href="/docs/middleware.html">Middleware</a></li>
    <li><a href="/docs/request.html">Request</a></li>
    <li><a href="/docs/response.html">Response</a></li>
</ul>

<h5>Core Traits</h5>
<ul>
    <li><a href="/docs/helper.html">Helper</a></li>
    <li><a href="/docs/data.html">Data</a></li>
    <li><a href="/docs/resolver.html">Resolver</a></li>
    <li><a href="/docs/profiler.html">Profiler</a></li>
</ul>

<h5>Exporting</h5>
<ul>
    <li><a href="/docs/integration.html">Integration</a></li>
    <li><a href="/docs/packages.html">Packages</a></li>
</ul>

<!--<h5>Kitchen Sink</h5>
<ul>
    <li><a href="/docs/sink-intro.html">Introduction</a></li>
    <li><a href="/docs/sink-facade.html">Facades</a></li>
    <li><a href="/docs/sink-schema.html">Schema</a></li>
    <li><a href="/docs/sink-auth.html">Authentication</a></li>
    <li><a href="/docs/sink-file.html">Files</a></li>
    <li><a href="/docs/sink-mail.html">Mail</a></li>
    <li><a href="/docs/sink-queue.html">Queue</a></li>
    <li><a href="/docs/sink-csrf.html">CSRF</a></li>
    <li><a href="/docs/sink-captcha.html">Captcha</a></li>
    <li><a href="/docs/sink-handlebars.html">Handlebars</a></li>
</ul>

<h5>Core Packages</h5>
<ul>
    <li><a href="/docs/i18n.html">i18n</a></li>
    <li><a href="/docs/image.html">Image</a></li>
    <li><a href="/docs/curl.html">cURL</a></li>
    <li><a href="/docs/sql.html">SQL</a></li>
    <li><a href="/docs/handlebars.html">Handlebars</a></li>
</ul>-->
   
        </div>
        <div class="right col-xs-12 col-md-10">
        	<h1>Facades</h1>
<p>To start off with a reference, we will be using the setup described in
<a href="/docs/app.html">Writing an App</a>. The first thing you want to do before
continuing is to create a project namespace in <code class="language-php">composer.json</code> like the
following. Then run <code class="language-php">composer dump-autoload</code> to rebuild the autoload.</p>
<pre class="code line-numbers language-php"><code class="marked">{
    "autoload": {
        "psr-4": {"Cradle\\App\\Www\\": "app/www/"}
    }
}
</code></pre>
<p>Facades are used in Cradle to return a callback of your actual class method.
Facades closely works with controllers and controllers closely work with actions.
Facades are arguably more efficient than events in general when it comes to
flows because since they directly return a callback, it doesn't add to the
event handler. Before we delve into facades, let's review how flows work.</p>
<pre class="code line-numbers language-php"><code class="marked">
cradle()-&gt;flow(
    'A process flow',
    'An event',
    //add a logger
    function($request, $response) {
        echo 'Hello World';
    }
);

</code></pre>
<p>In Cradle, there is an existing callback that log messages and you can use
it like this.</p>
<pre class="code line-numbers language-php"><code class="marked">
use Cradle\Framework\Flow;

cradle()-&gt;flow(
    'A process flow',
    'An event',
    //add a logger
    Flow::log()-&gt;debug('Hello World')
);

</code></pre>
<p><code class="language-php">Flow::log()-&gt;debug('Hello World')</code> does the exact the same thing as the
first example, outputs <code class="language-php">'Hello World'</code> because <code class="language-php">Flow::log()-&gt;debug('Hello World')</code>
returns a callback just like the first example.</p>
<p>Instead of remembering a list of facades, Cradle rolls all facades in a magical class
called <code class="language-php">Flow</code> used above. To add controllers in your package to the Flow object
you simply need to register it like the following.</p>
<pre class="code line-numbers language-php"><code class="marked">
use Cradle\App\Www\Controller;

Flow::register('custom', function () {
    static $cache = null;

    if (is_null($cache)) {
        $cache = new Controller(cradle());
    }

    return $cache;
});

</code></pre>
<div class="alert alert-info"><i class="fa fa-info-circle"></i> While you can define the above code anywhere, it's recommended to put it
inside of your `.cradle` file.
</div>
<p>Also please note <code class="language-php">new Controller(cradle())</code> which passes the App to the
controller. This will be used later. For illustration purposes define your
controller like the following.</p>
<pre class="code line-numbers language-php"><code class="marked">
namespace Cradle\App\Www;

class Controller
{
    public function hello()
    {
        return function($request, $response) {
            echo 'Hello World';
        };
    }
}

</code></pre>
<p>Now we can call on our controller like the following example.</p>
<pre class="code line-numbers language-php"><code class="marked">
Flow::custom()-&gt;hello();

</code></pre>
<p>While this being fantastic, overtime you will have a bunch of methods that
cannot be used directly. To prevent having to return a callback, we need to
add two things. The first one is add a helper trait called <code class="language-php">FlowTrait</code> used
like below.</p>
<pre class="code line-numbers language-php"><code class="marked">
namespace Cradle\App\Www;

use Cradle\Framework\App;
use Cradle\Framework\FlowTrait;

use Cradle\App\Www\Action\Hello;

class Controller
{
    use FlowTrait {
        FlowTrait::__callFlow as __call;
        FlowTrait::__getFlow as __get;
    }

    public function __construct(App $app)
    {
        $this-&gt;actions['hello'] = $this-&gt;resolve(Hello::class, $app);
    }
}

</code></pre>
<p>Several things happened in the example above. First off <code class="language-php">Flow</code> comes with a
helper trait called <code class="language-php">FlowTrait</code>. And <code class="language-php">FlowTrait</code> is used to delay your methods
by wrapping methods in a callback and returning that instead. The exact
definition of flow traits is provided below. The second thing is that we
registered an action to the <code class="language-php">FlowTrait</code> using <code class="language-php">resolve</code>. To learn more about
<code class="language-php">resolve</code> you can see the section about <a href="/docs/resolver.html">Resolvers</a>.</p>
<h6>Definition of the FlowTrait</h6>
<pre class="code line-numbers language-php"><code class="marked">
trait FlowTrait
{
    use ResolverTrait;

    /**
     * @var array $actions
     */
    protected $actions = array();

    /**
     * @var array $current
     */
    protected $current = null;

    /**
     * Returns the action property
     * example `Flow::auth()-&gt;load()`
     * example `Flow::auth()-&gt;search()-&gt;load()`
     * example `Flow::auth()-&gt;search-&gt;load()`
     *
     * @param *string $name
     * @param *array  $args
     *
     * @return string
     */
    public function __callFlow($name, $args)
    {
        if (is_null($this-&gt;current)) {
            if (!isset($this-&gt;actions[$name])) {
                return $this;
            }

            //its the search part in `Flow::auth()-&gt;search()-&gt;load()`
            $this-&gt;current = $this-&gt;actions[$name];
            return $this;
        }

        //its the load part in `Flow::auth()-&gt;search()-&gt;load()`
        $action = $this-&gt;current;
        $this-&gt;current = null;

        if (property_exists($action, $name)) {
            return $action-&gt;$name;
        }

        return function ($request, $response) use ($action, $name, &amp;$args) {
            //we should throw a method exist error at runtime
            $results = $action-&gt;$name($request, $response, ...$args);

            if ($results instanceof $action) {
                return;
            }

            return $results;
        };
    }

    /**
     * Returns the action property
     * example `Flow::auth()-&gt;search-&gt;load`
     *
     * @param *string $name
     *
     * @return string|callable
     */
    public function __getFlow($name)
    {
        return $this-&gt;__callFlow($name, array());
    }
}

</code></pre>
<p>Before we fire off our custom facade the next thing to do is create an action
class called <code class="language-php">Cradle\App\Www\Action\Hello</code>.</p>
<pre class="code line-numbers language-php"><code class="marked">&lt;?php

namespace Cradle\App\Www\Action;

use Cradle\Framework\App;

class Hello
{
    protected $app;

    public function __construct(App $app)
    {
        $this-&gt;app = $app;
    }

    public function world($request, $response) {
        echo 'Hello World';

        return $this;
    }
}

</code></pre>
<p>If you made it this far, you can now add your custom facade like the following.</p>
<pre class="code line-numbers language-php"><code class="marked">
use Cradle\Framework\Flow;

cradle()-&gt;flow(
    'A process flow',
    'An event',
    //add a logger
    Flow::custom()-&gt;hello-&gt;world
);

</code></pre>
<p>You can accept additional parameters to your custom methods like this.</p>
<pre class="code line-numbers language-php"><code class="marked">
Flow::custom()-&gt;hello-&gt;world($foo, 'bar');

</code></pre>
<p>In which can be accepted by your methods like this.</p>
<pre class="code line-numbers language-php"><code class="marked">public function world($request, $response, $foo, $bar) {
    echo 'Hello World';
    return $this;
}
</code></pre>
        </div>

    </div>
</div>

            </div>
        </section>
        <footer>
            <div class="container">
	<div class="top clearfix">
        <div class="left pull-left">
            <div>
                <div class="logo pull-left"><img src="/www/images/logo-square.png" /></div>
                <div class="title">Cradle PHP</div>
                <ul>
                    <li><a href="https://github.com/CradlePHP/Cradle">GitHub</a></li>
                    <li><a href="https://packagist.org/packages/cradlephp/cradle">Packagist</a></li>
                </ul>
            </div>
        </div>

        <div class="middle pull-right">
            <ul>
                <li><a href="https://cradlepphp.github.io/docs/intro.html">Getting Started</a></li>
                <li><a href="https://cradlepphp.github.io/docs/install.html">Install</a></li>
                <li><a href="https://cradlepphp.github.io/docs/intro.html">Documentation</a></li>
            </ul>
        </div>


    </div>
    <div class="masthead">
    	<center class="copy">
            <a href="https://travis-ci.org/CradlePHP/framework"><img src="https://travis-ci.org/CradlePHP/framework.svg?branch=master" alt="Travis CI" style="max-width:100%;"></a>
            <a href='https://coveralls.io/github/CradlePHP/framework?branch=master'><img src='https://coveralls.io/repos/github/CradlePHP/framework/badge.svg?branch=master' alt='Coverage Status' /></a>
            <a href="https://packagist.org/packages/cradlephp/framework"><img src="https://poser.pugx.org/cradlephp/framework/v/stable" alt="Latest Stable Version"  style="max-width:100%;"></a>
            <a href="https://packagist.org/packages/cradlephp/framework"><img alt="Total Downloads" src="https://poser.pugx.org/cradlephp/framework/downloads" style="max-width:100%;"></a>
            <a href="https://packagist.org/packages/cradlephp/framework"><img alt="Latest Unstable Version" src="https://poser.pugx.org/cradlephp/framework/v/unstable" style="max-width:100%;"></a>
            <a href="https://packagist.org/packages/cradlephp/framework"><img alt="License" src="https://poser.pugx.org/cradlephp/framework/license" style="max-width:100%;"></a>
            <br /><br />&copy; CradlePHP 2016
        </center>
    </div>
</div>

        </footer>
        <script type="text/javascript" src="/www/scripts/prism.js"></script>
    </body>
</html>
